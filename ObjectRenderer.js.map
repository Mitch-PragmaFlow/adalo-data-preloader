{"version":3,"sources":["../../src/components/ObjectRenderer.js"],"names":["mapping","LABEL","Label","SECTION","Section","LINE","Line","IMAGE","Image","ELLIPSE","Ellipse","SHAPE","Shape","GROUP","Group","WRAPPER","Wrapper","ROW","Row","COLUMN","Column","LIST","List","INPUT","Input","IMAGE_UPLOAD","ImageUpload","FILE_UPLOAD","FileUpload","DATE_PICKER","DatePicker","CHECKBOX","Checkbox","FORM","Form","SELECT","Select","ROW_SPACER","RowSpacer","COLUMN_SPACER","ColumnSpacer","WEB_VIEW","WebView","COMPONENT_INSTANCE","ComponentInstance","LIBRARY_COMPONENT","LibraryComponent","listItem","WrappedListItem","ObjectRenderer","Component","children","active","component","topScreen","props","filter","c","length","object","console","log","Error","map","child","id","render","app","bindingData","parentBindingData","isReusableComponent","visible","getBinding","getParams","getApp","getFileUploadsBaseURL","getImageUploadsBaseURL","onEnter","setUploading","formSubmitSuccess","state","hidden","branding","attributes","baseProps","renderChildren","ObjectClass","type","warn","Object","keys","actions","eventType","events","TAP","forEach","a","actionType","actionTypes","NAVIGATE","targetId","options","target","targetComponent","components","dependencies","formInputs","getDatasources","datasources","dataBindings","dep","getBaseURL","appVersion","getStore","context","datasource","getDatasource","datasourceId","componentId","bindingIds","getState","e","error","mapStateToProps","getBindingsList","ConnectedObjectRenderer","fetch","WrappedObjectRenderer","PropTypes","func","MultipleObjectRenderer","objects","obj"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport {\n  events,\n  actionTypes,\n  LABEL,\n  SECTION,\n  ELLIPSE,\n  SHAPE,\n  IMAGE,\n  WRAPPER,\n  GROUP,\n  LIST,\n  INPUT,\n  IMAGE_UPLOAD,\n  FILE_UPLOAD,\n  DATE_PICKER,\n  CHECKBOX,\n  FORM,\n  SELECT,\n  ROW,\n  COLUMN,\n  ROW_SPACER,\n  COLUMN_SPACER,\n  WEB_VIEW,\n  COMPONENT_INSTANCE,\n  LIBRARY_COMPONENT,\n  LINE,\n} from '@adalo/constants'\n\nimport { getObjectBinding, getDependencies } from '../utils/dependencies'\nimport { getVisible } from '../utils/visibility'\nimport { normalizeAttributes } from '../utils/styles'\n\nimport Label from './Label'\nimport Section from './Section'\nimport Line from './Line'\nimport Ellipse from './Ellipse'\nimport Shape from './Shape'\nimport Image from './Image'\nimport Input from './Input'\nimport ImageUpload from './ImageUpload'\nimport FileUpload from './FileUpload'\nimport DatePicker from './DatePicker'\nimport Select from './Select'\nimport Checkbox from './Checkbox'\nimport Form from './Form'\nimport WebView from './WebView'\nimport Group from './Group'\nimport List, { WrappedListItem } from './List'\nimport Wrapper from './Wrapper'\nimport Row from './Row'\nimport Column from './Column'\nimport RowSpacer from './RowSpacer'\nimport ColumnSpacer from './ColumnSpacer'\nimport ComponentInstance from './ComponentInstance'\nimport LibraryComponent from './LibraryComponent'\nimport { fetch } from '../ducks/data'\n\nconst mapping = {\n  [LABEL]: Label,\n  [SECTION]: Section,\n  [LINE]: Line,\n  [IMAGE]: Image,\n  [ELLIPSE]: Ellipse,\n  [SHAPE]: Shape,\n  [GROUP]: Group,\n  [WRAPPER]: Wrapper,\n  [ROW]: Row,\n  [COLUMN]: Column,\n  [LIST]: List,\n  [INPUT]: Input,\n  [IMAGE_UPLOAD]: ImageUpload,\n  [FILE_UPLOAD]: FileUpload,\n  [DATE_PICKER]: DatePicker,\n  [CHECKBOX]: Checkbox,\n  [FORM]: Form,\n  [SELECT]: Select,\n  [ROW_SPACER]: RowSpacer,\n  [COLUMN_SPACER]: ColumnSpacer,\n  [WEB_VIEW]: WebView,\n  [COMPONENT_INSTANCE]: ComponentInstance,\n  [LIBRARY_COMPONENT]: LibraryComponent,\n  listItem: WrappedListItem,\n}\n\nexport class ObjectRenderer extends Component {\n  renderChildren = children => {\n    let { active, component, topScreen } = this.props\n\n    if (children.filter(c => !c).length > 0) {\n      const { object } = this.props\n      console.log('--------> INFO:', object)\n      throw new Error('ENCOUNTERED NULL CHILD!')\n    }\n    return children.map(child => (\n      <WrappedObjectRenderer\n        key={child.id}\n        object={child}\n        component={component}\n        active={active}\n        topScreen={topScreen}\n      />\n    ))\n  }\n\n  render() {\n    let {\n      app,\n      active,\n      topScreen,\n      component,\n      object,\n      bindingData,\n      parentBindingData,\n      isReusableComponent,\n      visible,\n      getBinding,\n      getParams,\n      getApp,\n      getFileUploadsBaseURL,\n      getImageUploadsBaseURL,\n      onEnter,\n      setUploading,\n      formSubmitSuccess,\n      state,\n    } = this.props\n\n    if (object.hidden || !visible) {\n      return null\n    }\n\n    // normalize all object attributes to their desired value\n    if (app && app.branding) {\n      object.attributes = normalizeAttributes(object.attributes, app.branding)\n    }\n\n    let baseProps = {\n      isReusableComponent,\n      app,\n      component,\n      object,\n      active,\n      bindingData,\n      parentBindingData,\n      topScreen,\n      getBinding,\n      getParams,\n      getApp,\n      renderChildren: this.renderChildren,\n      getFileUploadsBaseURL,\n      getImageUploadsBaseURL,\n      onEnter,\n      formSubmitSuccess,\n    }\n\n    let ObjectClass = mapping[object.type]\n\n    if (!ObjectClass) {\n      console.warn(`I don't know how to render ${object.type}`)\n\n      return null\n    }\n\n    if (object.type === IMAGE_UPLOAD) {\n      baseProps.setUploading = setUploading\n    }\n\n    // in the event there is a navigation to render, lets prefetch the data\n    Object.keys(object.actions)\n      .filter(id => object.actions[id].eventType === events.TAP)\n      .forEach(id => {\n        object.actions[id].actions.forEach(a => {\n          if (a.actionType === actionTypes.NAVIGATE) {\n            try {\n              // get target component\n              let targetId = a.options.target\n              let app = getApp()\n              let targetComponent = app.components[targetId]\n\n              let dependencies = getDependencies(targetComponent, {\n                formInputs: {},\n                getDatasources: () => (app && app.datasources) || {},\n                getApp,\n                state,\n              })\n              let dataBindings = {}\n              dependencies.forEach(dep => {\n                let { getBaseURL, appVersion, getStore } = this.context\n                return fetch(getBaseURL(), {\n                  ...dep,\n                  datasource: this.getDatasource(dep.datasourceId),\n                  componentId: targetId,\n                  bindingIds: Object.keys(dataBindings),\n                  appVersion,\n                  state: getStore().getState(),\n                  getParams: this.getParams,\n                })\n              })\n            } catch (e) {\n              console.error(e)\n            }\n          }\n        })\n      })\n\n    return (\n      <ObjectClass {...baseProps}>\n        {object.children ? this.renderChildren(object.children) : null}\n      </ObjectClass>\n    )\n  }\n}\n\nconst mapStateToProps = (state, props) => {\n  let {\n    object,\n    getBinding,\n    getBindingsList,\n    getParams,\n    getFileUploadsBaseURL,\n    getImageUploadsBaseURL,\n    getApp,\n  } = props\n\n  return {\n    bindingData: getObjectBinding(state, object, {\n      getParams,\n      getBinding,\n      getBindingsList,\n      getFileUploadsBaseURL,\n      getImageUploadsBaseURL,\n      getApp,\n    }),\n    visible: getVisible(state, object, {\n      getParams,\n      getBinding,\n      getBindingsList,\n      getApp,\n    }),\n    state,\n  }\n}\n\nconst ConnectedObjectRenderer = connect(mapStateToProps, { fetch })(\n  ObjectRenderer\n)\n\nexport default class WrappedObjectRenderer extends Component {\n  static contextTypes = {\n    getBinding: PropTypes.func,\n    getBindingsList: PropTypes.func,\n    getParams: PropTypes.func,\n    getApp: PropTypes.func,\n    getFileUploadsBaseURL: PropTypes.func,\n    getImageUploadsBaseURL: PropTypes.func,\n  }\n\n  render() {\n    let { getApp } = this.context\n\n    let app = getApp()\n\n    return (\n      <ConnectedObjectRenderer {...this.props} {...this.context} app={app} />\n    )\n  }\n}\n\nexport class MultipleObjectRenderer extends Component {\n  render() {\n    let { objects, ...props } = this.props\n\n    return (\n      <React.Fragment>\n        {objects.map(obj => (\n          <WrappedObjectRenderer {...props} key={obj.id} object={obj} />\n        ))}\n      </React.Fragment>\n    )\n  }\n}\n"],"file":"ObjectRenderer.js"}